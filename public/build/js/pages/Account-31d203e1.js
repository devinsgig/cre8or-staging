import{s as x,B as v,m as b,p as k,cg as R,ch as B,_ as y,r as d,o as f,c as g,b as o,t as a,d as l,w as p,y as _,e as c,u as w,W as P,h as N,$ as C}from"../../assets/app-8df99815.js";import{C as S,u as T}from"./CloudFlareTurnstile-dd2b6044.js";import{B as I}from"./BaseInputTel-35ebd3b3.js";const A={components:{BaseInputText:x,BaseButton:v},inject:["dialogRef"],data(){return{code:null,loadingSend:!1,loadingResend:!1,phoneNumber:this.dialogRef.data.phone_number,password:this.dialogRef.data.password}},computed:{...b(_,["user"]),formattedPhoneNumber(){return this.phoneNumber.replace(/\s+/g,"")}},methods:{...k(_,["updateUserMeInfo"]),async handleCheckPhoneEdit(){this.loadingSend=!0;try{await R({code:this.code,phone_number:this.phoneNumber}),this.dialogRef.close(),this.updateUserMeInfo({...this.user,phone_number:this.formattedPhoneNumber}),this.showSuccess(this.$t("Successfully changed"))}catch(s){this.showError(s.error)}finally{this.loadingSend=!1}},async handleSendPhoneVerify(){if(!this.loadingResend){this.loadingResend=!0;try{await B({phone_number:this.phoneNumber,password:this.password}),this.resetErrors(this.error),this.dialogRef.close(),this.$dialog.open(V,{data:{phone_number:this.phoneNumber},props:{header:this.$t("Enter your code"),modal:!0,dismissableMask:!0,draggable:!1}})}catch(s){this.showError(s.error)}finally{this.loadingResend=!1}}},reEnterPhoneNumber(){this.dialogRef.close(),this.$dialog.open(E,{props:{header:this.$t("Change Activate Phone"),modal:!0,dismissableMask:!0,draggable:!1,class:"enter-phone-modal"}})}}},M={class:"mb-1"},U={class:"flex flex-col gap-base-2"},D={class:"flex gap-base-2"};function W(s,e,h,$,n,r){const u=d("BaseInputText"),i=d("BaseButton");return f(),g("div",null,[o("p",M,a(s.$t("We just sent a code to your phone number"))+"Â "+a(n.phoneNumber)+".Â "+a(s.$t("Code will expire in 2 minutes.")),1),l(u,{modelValue:n.code,"onUpdate:modelValue":e[0]||(e[0]=t=>n.code=t),class:"w-full mb-base-2",placeholder:s.$t("Code"),autofocus:!0},null,8,["modelValue","placeholder"]),o("div",U,[l(i,{loading:n.loadingSend,onClick:e[1]||(e[1]=t=>r.handleCheckPhoneEdit())},{default:p(()=>[c(a(s.$t("Continue")),1)]),_:1},8,["loading"]),o("div",D,[l(i,{loading:n.loadingResend,class:"flex-1",type:"secondary",onClick:e[2]||(e[2]=t=>r.handleSendPhoneVerify(!1))},{default:p(()=>[c(a(s.$t("Resend code")),1)]),_:1},8,["loading"]),l(i,{type:"secondary",class:"flex-1",onClick:e[3]||(e[3]=t=>r.reEnterPhoneNumber())},{default:p(()=>[c(a(s.$t("Re-enter phone number")),1)]),_:1})])])])}const V=y(A,[["render",W]]),j={components:{BaseButton:v,BaseInputTel:I,CloudFlareTurnstile:S},inject:["dialogRef"],data(){const s=w(),e=T(s.config.sendPhoneEnableRecapcha,this.enableRecapcha,this.enableTurnstile);return{token:null,phoneNumber:null,error:{phone_number:null},loadingChange:!1,...e}},computed:{...b(w,["config"])},mounted(){setTimeout(()=>{this.loadRecaptcha(this.$recaptchaInstance)},2e3)},unmounted(){this.unloadRecaptcha(this.$recaptchaInstance)},methods:{async handleChangePhone(){const s=this.$dialog.open(P,{props:{header:this.$t("Enter Password"),class:"password-modal",modal:!0,dismissableMask:!0,draggable:!1},emits:{onConfirm:async e=>{if(e.password){if(this.loadingChange)return;this.loadingChange=!0;try{this.token=await this.getCaptchaToken(this.$recaptcha,this.turnstileToken,"send_phone"),await B({phone_number:this.phoneNumber,password:e.password,token:this.token}),this.resetErrors(this.error),this.dialogRef.close(),this.$dialog.open(V,{data:{phone_number:this.phoneNumber,password:e.password},props:{header:this.$t("Enter your code"),modal:!0,dismissableMask:!0,draggable:!1}})}catch(h){this.handleApiErrors(this.error,h)}finally{this.loadingChange=!1,s.close()}}}}})}}},F={class:"font-medium dark:text-white"},Y={key:0,class:"text-center"};function q(s,e,h,$,n,r){const u=d("BaseInputTel"),i=d("CloudFlareTurnstile"),t=d("BaseButton");return f(),g("form",{onSubmit:e[2]||(e[2]=C((...m)=>r.handleChangePhone&&r.handleChangePhone(...m),["prevent"])),class:"flex flex-col gap-y-base-2"},[o("p",F,a(s.$t("Please enter your phone number in the box below to verify your phone number. We will send the verification code to your device.")),1),l(u,{modelValue:n.phoneNumber,"onUpdate:modelValue":e[0]||(e[0]=m=>n.phoneNumber=m),placeholder:s.$t("Phone Number"),error:n.error.phone_number,autofocus:""},null,8,["modelValue","placeholder","error"]),s.enableWidget?(f(),g("div",Y,[l(i,{modelValue:s.turnstileToken,"onUpdate:modelValue":e[1]||(e[1]=m=>s.turnstileToken=m)},null,8,["modelValue"])])):N("",!0),l(t,{loading:n.loadingChange,disabled:!s.isVerified()},{default:p(()=>[c(a(s.$t("Change")),1)]),_:1},8,["loading","disabled"])],32)}const E=y(j,[["render",q]]),z={components:{BaseButton:v,BaseInputText:x},data(){return{email:null,user_name:null,phoneNumber:null,error:{email:null,user_name:null,phone_number:null}}},computed:{...b(_,["user"]),...b(w,["config"])},watch:{user(){this.handleInitData()}},mounted(){this.handleInitData()},methods:{...k(_,["storeAccountSettings"]),handleInitData(){this.email=this.user.email,this.user_name=this.user.user_name,this.phoneNumber=this.user.phone_number},async saveAccount(){const s=this.$dialog.open(P,{props:{header:this.$t("Enter Password"),class:"password-modal",modal:!0,dismissableMask:!0,draggable:!1},emits:{onConfirm:async e=>{if(e.password)try{await this.storeAccountSettings({email:this.email,password:e.password,user_name:this.user_name}),this.showSuccess(this.$t("Your changes have been saved.")),this.resetErrors(this.error),s.close()}catch(h){this.handleApiErrors(this.error,h),s.close()}}}})},handleChangePhone(){this.$dialog.open(E,{props:{header:this.$t("Update Phone Number"),modal:!0,dismissableMask:!0,draggable:!1,class:"enter-phone-modal"}})}}},G={class:"flex flex-wrap gap-x-5 mb-3"},H={class:"md:flex-1 md:text-end w-full mb-1 pt-0 md:pt-2"},J={class:"md:flex-2 w-full"},K={class:"flex flex-wrap gap-x-5 mb-3"},L={class:"md:flex-1 md:text-end w-full mb-1 pt-0 md:pt-2"},O={class:"md:flex-2 w-full"},Q={key:0,class:"flex flex-wrap gap-x-5 mb-3"},X={class:"md:flex-1 md:text-end w-full mb-1"},Z={class:"md:flex-2 w-full"},ee={class:"flex items-center gap-base-2"},se={class:"flex-1"},oe={class:"flex flex-wrap gap-x-5"},ne={class:"md:flex-2 w-full"};function te(s,e,h,$,n,r){const u=d("BaseInputText"),i=d("BaseButton");return f(),g("form",{onSubmit:e[3]||(e[3]=C((...t)=>r.saveAccount&&r.saveAccount(...t),["prevent"]))},[o("div",G,[o("div",H,[o("label",null,a(s.$t("Email")),1)]),o("div",J,[l(u,{modelValue:n.email,"onUpdate:modelValue":e[0]||(e[0]=t=>n.email=t),error:n.error.email},null,8,["modelValue","error"])])]),o("div",K,[o("div",L,[o("label",null,a(s.$t("Username")),1)]),o("div",O,[l(u,{modelValue:n.user_name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.user_name=t),error:n.error.user_name},null,8,["modelValue","error"])])]),s.config.phoneVerify?(f(),g("div",Q,[o("div",X,[o("label",null,a(s.$t("Phone Number")),1)]),o("div",Z,[o("div",ee,[o("div",se,a(n.phoneNumber),1),o("button",{class:"underline",onClick:e[2]||(e[2]=C((...t)=>r.handleChangePhone&&r.handleChangePhone(...t),["prevent"]))},a(s.$t("Change")),1)])])])):N("",!0),o("div",oe,[e[4]||(e[4]=o("div",{class:"md:flex-1 md:text-end w-full"},null,-1)),o("div",ne,[l(i,{class:"w-full"},{default:p(()=>[c(a(s.$t("Save")),1)]),_:1})])])],32)}const ie=y(z,[["render",te]]);export{ie as default};
