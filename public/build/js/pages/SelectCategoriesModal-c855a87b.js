import{_ as v,B as D,s as L,aH as y,cH as B,cI as x,cJ as k,cK as S,r as u,o as l,c as d,d as h,b as c,F as f,f as C,t as g,h as V,w as I,e as T,$ as j}from"../../assets/app-8df99815.js";var m=null;const P={components:{BaseButton:D,BaseInputText:L,BaseCheckbox:y},inject:["dialogRef"],data(){return{categoryKeyword:null,categoriesList:[],filteredCategoriesList:[],categoriesData:this.dialogRef.data.categoriesData}},mounted(){this.fetchPageCategories()},methods:{closeStatusBox(){this.dialogRef.close()},async fetchPageCategories(){try{let e;switch(this.categoriesData.subject_type){case"group":e=await x();break;default:e=await B();break}this.categoriesList=e,this.filteredCategoriesList=e}catch(e){console.log(e)}},handleChangeChildCategory(e){this.categoriesData.selected_category_ids.includes(e.id)||this.categoriesData.selected_category_ids.push(e.id)},handleChangeParentCategory(e){this.categoriesData.selected_category_ids.includes(e.id)||(this.categoriesData.selected_category_ids=window._.differenceBy(this.categoriesData.selected_category_ids,e.childs.map(t=>t.id)))},filterCategoriesList(e,t){return e.filter(a=>{var o=a.childs;return o&&o.length&&(a.childs=this.filterCategoriesList(o,t.toLowerCase()),a.childs&&a.childs.length)?!0:a.name.toLowerCase().indexOf(t.toLowerCase())>-1})},handleSearchCategories(){clearTimeout(m),m=setTimeout(()=>{const e=window._.cloneDeep(this.categoriesList);this.filteredCategoriesList=this.filterCategoriesList(e,this.categoryKeyword)},400)},selectedCategoriesList(e,t){var a=[];return window._.forEach(e,function(o){t.includes(o.id)&&a.push(o),o.childs&&o.childs.length&&window._.forEach(o.childs,function(i){t.includes(i.id)&&a.push(i)})}),a},async handleSelectCategories(){try{if(this.categoriesData.selected_type==="save"){switch(this.categoriesData.subject_type){case"group":await S({id:this.categoriesData.subject_id,categories:this.categoriesData.selected_category_ids});break;default:await k({categories:this.categoriesData.selected_category_ids});break}this.showSuccess(this.$t("Your changes have been saved."))}this.dialogRef.close({selectedCategoriesList:this.selectedCategoriesList(this.categoriesList,this.categoriesData.selected_category_ids)})}catch(e){this.showError(e.error)}}}},K={key:0},N={class:"flex justify-between items-center mb-4 font-bold"},E=["for"],R={key:0},U=["for"],F={key:1,class:"text-center pb-12"},G={class:"p-dialog-footer-fixed absolute left-0 bottom-0 right-0 px-6 pt-base-2 pb-6 rounded-b-base-lg bg-white dark:bg-slate-800"};function H(e,t,a,o,i,n){const b=u("BaseInputText"),_=u("BaseCheckbox"),w=u("BaseButton");return l(),d(f,null,[h(b,{modelValue:i.categoryKeyword,"onUpdate:modelValue":t[0]||(t[0]=s=>i.categoryKeyword=s),onInput:t[1]||(t[1]=s=>n.handleSearchCategories()),placeholder:e.$t("Search Categories"),autofocus:!0,class:"mb-base-2"},null,8,["modelValue","placeholder"]),c("form",{onSubmit:t[4]||(t[4]=j((...s)=>n.handleSelectCategories&&n.handleSelectCategories(...s),["prevent"]))},[i.categoriesList.length?(l(),d("div",K,[(l(!0),d(f,null,C(i.filteredCategoriesList,s=>(l(),d("div",{key:s.id},[c("div",N,[c("label",{for:s.id,class:"flex-1"},g(s.name),9,E),h(_,{value:s.id,modelValue:i.categoriesData.selected_category_ids,"onUpdate:modelValue":t[2]||(t[2]=r=>i.categoriesData.selected_category_ids=r),inputId:s.id.toString(),onChange:r=>n.handleChangeParentCategory(s)},null,8,["value","modelValue","inputId","onChange"])]),s.childs.length>0?(l(),d("div",R,[(l(!0),d(f,null,C(s.childs,r=>(l(),d("div",{key:r.id,class:"flex justify-between items-center ms-5 mb-4"},[c("label",{for:r.id,class:"flex-1"},g(r.name),9,U),h(_,{value:r.id,modelValue:i.categoriesData.selected_category_ids,"onUpdate:modelValue":t[3]||(t[3]=p=>i.categoriesData.selected_category_ids=p),inputId:r.id.toString(),onChange:p=>n.handleChangeChildCategory(s)},null,8,["value","modelValue","inputId","onChange"])]))),128))])):V("",!0)]))),128))])):(l(),d("div",F,g(e.$t("No results found")),1)),c("div",G,[h(w,{class:"w-full"},{default:I(()=>[T(g(e.$t("Select")),1)]),_:1})])],32)],64)}const J=v(P,[["render",H]]);export{J as S};
