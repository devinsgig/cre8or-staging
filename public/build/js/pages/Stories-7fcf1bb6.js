import{_ as x,j as L,c4 as C,aB as I,b0 as P,b1 as B,bU as j,m as u,y as A,bV as M,bK as U,u as D,dm as z,dn as V,l as g,ad as $,r as i,o,c as a,b as s,t as b,h as m,g as _,w as f,d as l,F as N,f as O,Q as E}from"../../assets/app-8df99815.js";import{S as F}from"./StoryDetailModal-32bf749a.js";import"./StoryDetail-ca434ce3.js";const H={components:{BaseIcon:L,StoryContentPreview:C,InfiniteLoading:I,Avatar:P,UserName:B,SlimScroll:j},props:["data","params","position"],data(){return{storiesList:[],currentPage:1}},computed:{...u(A,["user","authenticated"]),...u(M,["seenStoryItem","deleteStoryItem"]),...u(U,["samePage"]),...u(D,["setOpenedModalCount"])},mounted(){this.getStoriesList(this.currentPage)},watch:{seenStoryItem(e){var t=window._.find(this.storiesList,{id:e.storyItem.story_id});t&&(!t.seen&&t.item.id!=e.storyItem.id&&(t.item=e.storyItem),!t.seen&&e.seen&&(t.seen=!0))},async deleteStoryItem(e){var t=window._.findIndex(this.storiesList,function(h){return h.id==e.storyId});if(t!=-1)try{var n=await z(e.storyId);this.storiesList[t]=n}catch{this.storiesList=this.storiesList.filter(d=>d.id!==e.storyId)}},samePage(){this.currentPage=1,this.storiesList=[],this.getStoriesList(this.currentPage)}},methods:{async getStoriesList(e){if(this.authenticated)try{let t=await V(e);return e==1&&(this.storiesList=[]),this.storiesList=window._.concat(this.storiesList,t),t}catch(t){this.showError(t.error)}},showStoryDetail(e){let t=this.$router.resolve({name:"story_view",params:{storyId:e}});g(t.fullPath),this.setOpenedModalCount(),this.$dialog.open(F,{data:{id:e,storiesList:this.storiesList},props:{class:"p-dialog-story p-dialog-story-detail p-dialog-no-header-title",modal:!0,showHeader:!1,draggable:!1},onClose:()=>{g(this.$router.currentRoute.value.fullPath),$(),this.setOpenedModalCount(!1)}})},loadMoreStories(e){this.getStoriesList(++this.currentPage).then(t=>{t.length===0?e.complete():e.loaded()})},createStory(){if(this.user){let e="story.allow_create";this.checkPermission(e)&&this.$router.push({name:"stories"})}}}},K={key:0,class:"widget-box bg-white border border-white rounded-none md:rounded-base-lg p-4 mb-base-2 dark:bg-slate-800 dark:border-slate-800"},Q={key:0,class:"widget-box-header flex flex-wrap items-center justify-between gap-2 mb-5"},R={class:"widget-box-header-title text-main-color text-base-lg font-extrabold dark:text-white"},Y={class:"create-story-box border border-divider rounded-base-lg relative pb-story-ratio bg-cover bg-center dark:bg-slate-800 dark:border-white/10"},q={class:"absolute left-0 top-0 right-0 bottom-16 border-b border-divider dark:border-white/10"},G={class:"h-full"},J=["src","alt"],T={class:"create-story-btn relative flex items-center justify-center bg-primary-color rounded-full -mt-5 w-10 h-10 mx-auto border-3 border-white z-10 dark:bg-dark-primary-color dark:border-slate-800"},W={class:"create-story-box-bottom absolute bottom-3 left-1 right-1 text-center font-semibold"},X=["onClick"],Z={class:"rounded-base-lg relative pb-story-ratio cursor-pointer text-sm overflow-hidden"},ee={class:"absolute left-3 top-2 z-10"},te={class:"create-story-box border border-divider rounded-base-lg relative pb-story-ratio bg-cover bg-center dark:bg-slate-800 dark:border-white/10"},se={class:"absolute left-0 top-0 right-0 bottom-16 border-b border-divider dark:border-white/10"},re={class:"h-full"},oe=["src","alt"],ie={class:"create-story-btn relative flex items-center justify-center bg-primary-color rounded-full -mt-5 w-10 h-10 mx-auto border-3 border-white z-10 dark:bg-dark-primary-color dark:border-slate-800"},ae={class:"create-story-box-bottom absolute bottom-3 left-1 right-1 text-center font-semibold"};function le(e,t,n,h,d,c){const p=i("BaseIcon"),v=i("Avatar"),y=i("StoryContentPreview"),w=i("UserName"),S=i("InfiniteLoading"),k=i("SlimScroll");return e.authenticated?(o(),a("div",K,[n.data.enable_title?(o(),a("div",Q,[s("h3",R,b(n.data.title),1)])):m("",!0),d.storiesList.length>0?(o(),_(k,{key:1},{default:f(()=>[s("div",{onClick:t[0]||(t[0]=r=>c.createStory()),class:"w-32 flex-32 cursor-pointer"},[s("div",Y,[s("div",q,[s("div",G,[s("img",{class:"h-full rounded-t-base-lg object-cover",src:e.user.avatar,alt:e.user.user_name},null,8,J)]),s("div",T,[l(p,{name:"plus",class:"text-white"})])]),s("div",W,b(e.$t("Create story")),1)])]),(o(!0),a(N,null,O(d.storiesList,r=>(o(),a("div",{class:"stories-list-scroll w-32 flex-32",key:r.id,onClick:ne=>c.showStoryDetail(r.id)},[s("div",Z,[s("div",ee,[l(v,{user:r.user,border:!1,class:E(["border-3 rounded-full",r.seen?"border-white":"border-color-link dark:border-dark-primary-color"])},null,8,["user","class"])]),r.item?(o(),_(y,{key:0,story:r.item,class:"pointer-events-none"},null,8,["story"])):m("",!0),l(w,{user:r.user,router:!1,activePopover:!1,class:"stories-list-scroll-name absolute left-3 bottom-3 right-3 text-white"},null,8,["user"])])],8,X))),128)),l(S,{onInfinite:c.loadMoreStories},{spinner:f(()=>t[2]||(t[2]=[s("span",null,null,-1)])),complete:f(()=>t[3]||(t[3]=[s("span",null,null,-1)])),_:1},8,["onInfinite"])]),_:1})):(o(),a("div",{key:2,onClick:t[1]||(t[1]=r=>c.createStory()),class:"w-32 flex-32 cursor-pointer"},[s("div",te,[s("div",se,[s("div",re,[s("img",{class:"h-full rounded-t-base-lg object-cover",src:e.user.avatar,alt:e.user.user_name},null,8,oe)]),s("div",ie,[l(p,{name:"plus",class:"text-white"})])]),s("div",ae,b(e.$t("Create story")),1)])]))])):m("",!0)}const he=x(H,[["render",le]]);export{he as default};
