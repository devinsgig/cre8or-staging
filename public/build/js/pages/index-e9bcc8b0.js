import{_ as B,B as I,a as N,r as h,o as s,c as a,b as n,t as c,S as R,h as p,d as C,F as d,g,w as f,e as k,Q as j,j as T,L as U,m as x,y as S,u as A,p as v,V as D,W as F,f as m}from"../../assets/app-8df99815.js";import{r as L,c as E}from"./subscription-dccd4f39.js";import{C as q}from"./CurrentPlan-7a657346.js";function z(){return window.axios.get("user_subscription/config").then(e=>e.data.data)}function M(){return window.axios.get("user_subscription/get_current").then(e=>e.data.data)}function Y(e){return window.axios.post("user_subscription/store",e).then(t=>t.data.data)}function K(e){return window.axios.post("user_subscription/store_trial",e).then(t=>t.data.data)}const O={props:["data","badgeStyle","currentPlan"],components:{BaseButton:I,BaseSelect:N},data(){return{selectedPlanId:this.data.plans[0].id}},computed:{selectedPlan(){return this.data.plans.find(e=>e.id===this.selectedPlanId)},isCurrentPlan(){var e;return((e=this.currentPlan)==null?void 0:e.plan_id)===this.selectedPlanId}},methods:{handleSelectPlan(e,t){this.$emit("select",{package:e,plan:t})},async handleResumePlan(e){this.$confirm.require({message:this.$t("Do you want to resume this subscription?"),header:this.$t("Please confirm"),acceptLabel:this.$t("Ok"),rejectLabel:this.$t("Cancel"),accept:async()=>{try{await L(e.subscription.id),this.$emit("update",e.subscription.id)}catch(t){this.showError(t.error)}}})},async handleCancelPlan(e){this.$confirm.require({message:this.$t("Your subscription will be canceled at the end of your billing period on")+" "+e.subscription.next_payment+". "+this.$t("You can change your mind anytime before this date."),header:this.$t("Cancel Subscription?"),acceptLabel:this.$t("Cancel Subscription"),rejectLabel:this.$t("Keep Subscription"),accept:async()=>{try{await E(e.subscription.id),this.$emit("update",e.subscription.id)}catch(t){this.showError(t.error)}}})}},emits:["select","update"]},Q={class:"flex flex-wrap items-center gap-base-1 leading-none"},W={class:"flex-1 text-base-lg font-extrabold leading-tight"},G={class:"font-bold"},H={key:0,class:"text-lg"},J={class:"text-3xl"},X={class:"whitespace-pre-wrap"},Z={class:"flex gap-base-2 absolute left-5 bottom-4 right-5"};function ee(e,t,r,w,o,i){const _=h("BaseSelect"),b=h("BaseButton");return s(),a("div",{class:j(["flex flex-col gap-base-2 border rounded-base-lg pt-5 px-5 pb-16 relative",i.isCurrentPlan?"bg-light-yellow border-dark-yellow dark:bg-gray-900 dark:border-white/10":"bg-transparent border-primary-color dark:border-dark-primary-color"])},[n("div",Q,[n("h5",W,c(r.data.name),1),r.data.is_highlight?(s(),a("div",{key:0,style:R({backgroundColor:r.badgeStyle.backgroundColor,color:r.badgeStyle.color}),class:"rounded p-1 text-base-xs self-start"},c(r.badgeStyle.text),5)):p("",!0)]),C(_,{modelValue:o.selectedPlanId,"onUpdate:modelValue":t[0]||(t[0]=u=>o.selectedPlanId=u),options:r.data.plans,optionLabel:"name",optionValue:"id"},null,8,["modelValue","options"]),n("div",G,[i.selectedPlan.trial_day?(s(),a("p",H,c(e.$filters.numberShortener(i.selectedPlan.trial_day,e.$t("[number] day trial then"),e.$t("[number] days trial then"))),1)):p("",!0),n("p",J,c(i.selectedPlan.description),1)]),n("div",X,c(r.data.description),1),n("div",Z,[i.isCurrentPlan?(s(),a(d,{key:0},[r.currentPlan.subscription.can_resume?(s(),g(b,{key:0,onClick:t[1]||(t[1]=u=>i.handleResumePlan(r.currentPlan)),class:"w-full"},{default:f(()=>[k(c(e.$t("Resume")),1)]),_:1})):p("",!0),r.currentPlan.subscription.can_cancel?(s(),g(b,{key:1,onClick:t[2]||(t[2]=u=>i.handleCancelPlan(r.currentPlan)),type:"secondary",class:"w-full"},{default:f(()=>[k(c(e.$t("Cancel")),1)]),_:1})):p("",!0)],64)):(s(),g(b,{key:1,onClick:t[3]||(t[3]=u=>i.handleSelectPlan(r.data,i.selectedPlan)),class:"w-full"},{default:f(()=>[k(c(i.selectedPlan.trial_day?e.$t("Start Trial"):e.$t("Select")),1)]),_:1}))])],2)}const te=B(O,[["render",ee]]),se={components:{BaseIcon:T,Loading:U,PackageBox:te,CurrentPlan:q},data(){return{currentPackage:null,subscriptionConfig:null,planSelected:[]}},mounted(){if(!this.config.membership.enable||this.user.is_moderator)return this.$router.push({name:"permission"});this.getConfig(),this.getCurrentPackpage()},computed:{...x(S,["user"]),...x(A,["config"])},methods:{...v(S,["updateCurrentPlan"]),...v(D,["pingNotification"]),async getConfig(){try{const e=await z();this.subscriptionConfig=e}catch(e){this.showError(e)}},async getCurrentPackpage(){try{const e=await M();this.currentPackage=e}catch(e){this.showError(e)}},async handleSelectPackage(e){const t=this.$dialog.open(F,{props:{header:this.$t("Enter Password"),class:"password-modal",modal:!0,dismissableMask:!0,draggable:!1},emits:{onConfirm:async r=>{if(r.password)try{e.plan.trial_day?await K({plan_id:e.plan.id,password:r.password}):await Y({plan_id:e.plan.id,password:r.password}),this.getCurrentPackpage(),this.getConfig(),this.updateCurrentPlan(e.package.name),this.pingNotification(),this.showSuccess(this.$t("Select package successfully.")),t.close()}catch(w){this.showError(w.error),t.close()}}}})},async handleCancelSubscription(e){try{await E(e),this.getCurrentPackpage()}catch(t){this.showError(t.error)}},async handleResumeSubscription(e){try{await L(e),this.getCurrentPackpage()}catch(t){this.showError(t.error)}}}},ae={class:"main-content-section bg-white border border-white text-main-color rounded-none md:rounded-base-lg p-5 mb-base-2 dark:bg-slate-800 dark:border-slate-800 dark:text-white"},re={class:"flex flex-wrap items-center justify-between gap-2 mb-base-2"},ne={class:"text-main-color text-base-lg font-extrabold dark:text-white"},oe={class:"mb-5"},ie={key:0},ce={class:"grid md:grid-cols-3 gap-5 mb-5"},le={key:0,class:"relative overflow-x-auto"},de={class:"w-full whitespace-nowrap text-center"},ue={class:"bg-table-header-color dark:bg-dark-web-wash"},he={scope:"col",class:"p-3 text-start rounded-l-base sticky left-0 bg-inherit max-w-xs whitespace-pre-wrap min-w-40"},pe={class:"p-3 text-start font-semibold rounded-l-base sticky left-0 bg-inherit max-w-xs whitespace-pre-wrap min-w-40"},ge={key:0},be={key:0,class:"text-base-green"},me={key:1,class:"text-base-red"},we={key:1,class:"text-center"};function _e(e,t,r,w,o,i){const _=h("CurrentPlan"),b=h("Loading"),u=h("PackageBox"),P=h("BaseIcon");return s(),a("div",ae,[n("div",re,[n("h3",ne,c(e.$t("Compare plans")),1)]),n("p",oe,c(e.$t("Please choose the appropriate package to subscribe. If you have an active subscription and decide to switch to another package to subscribe. The system will not refund and unused days will not be added to the new package. It's best to cancel your current package and wait for the cycle to end to switch to a new package.")),1),o.currentPackage?(s(),g(_,{key:0,subscription:o.currentPackage.subscription,onCancel:i.handleCancelSubscription,onResume:i.handleResumeSubscription,class:"mb-5"},null,8,["subscription","onCancel","onResume"])):p("",!0),o.subscriptionConfig?(s(),a(d,{key:2},[o.subscriptionConfig.packages.length?(s(),a("div",ie,[n("div",ce,[(s(!0),a(d,null,m(o.subscriptionConfig.packages,l=>(s(),g(u,{key:l.id,data:l,"current-plan":o.currentPackage,badgeStyle:{backgroundColor:o.subscriptionConfig.highlight_background_color,color:o.subscriptionConfig.highlight_text_color,text:o.subscriptionConfig.highlight_text},onSelect:i.handleSelectPackage,onUpdate:i.getCurrentPackpage},null,8,["data","current-plan","badgeStyle","onSelect","onUpdate"]))),128))]),o.subscriptionConfig.compares.length?(s(),a("div",le,[n("table",de,[n("thead",null,[n("tr",ue,[n("th",he,c(e.$t("Features")),1),(s(!0),a(d,null,m(o.subscriptionConfig.packages,l=>(s(),a("th",{key:l.id,scope:"col",class:"p-3 w-44 text-center last:rounded-r-base whitespace-pre-wrap"},c(l.name),1))),128))])]),n("tbody",null,[(s(!0),a(d,null,m(o.subscriptionConfig.compares,(l,V)=>(s(),a("tr",{key:V,class:"odd:bg-white odd:dark:bg-gray-800 even:bg-light-blue even:dark:bg-gray-900"},[n("td",pe,c(l.name),1),(s(!0),a(d,null,m(l.packages,(y,$)=>(s(),a("td",{key:$,class:"p-3 text-center last:rounded-r-base w-44 whitespace-pre-wrap"},[y.type=="text"?(s(),a("div",ge,c(y.value),1)):(s(),a(d,{key:1},[y.value==1?(s(),a("div",be,[C(P,{name:"check_circle"})])):(s(),a("div",me,[C(P,{name:"x_circle"})]))],64))]))),128))]))),128))])])])):p("",!0)])):(s(),a("div",we,c(e.$t("No packages available")),1))],64)):(s(),g(b,{key:1}))])}const Ce=B(se,[["render",_e]]);export{Ce as default};
