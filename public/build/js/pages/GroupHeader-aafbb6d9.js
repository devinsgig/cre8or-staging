import{_ as v,v as N,B as I,dp as A,r as p,o as s,c as r,d as f,w as y,e as w,t as l,$ as L,p as B,bD as S,dq as T,F as k,f as C,b as n,g as b,m as D,y as V,dr as q,bH as O,ad as E,Q as R,h,s as K,ds as J,a8 as P,u as j,dt as H,l as M,j as U,b0 as z,S as G}from"../../assets/app-8df99815.js";import{B as F}from"./BaseUploadCover-49ec6ee3.js";import{B as Q}from"./BaseSwitch-3591db5b.js";import{R as Y}from"./RuleItem-ebb1b7c5.js";const W={inject:["dialogRef"],data(){return{nameData:this.dialogRef.data.nameData}},components:{BaseTextarea:N,BaseButton:I},methods:{async handleSaveName(e,t=null){try{switch(this.nameData.subject_type){case"group":await A({id:t,name:e});break;default:break}this.dialogRef.close({name:e}),this.showSuccess(this.$t("Your changes have been saved."))}catch(u){this.showError(u.error)}}}};function X(e,t,u,_,a,o){const g=p("BaseTextarea"),m=p("BaseButton");return s(),r("form",{onSubmit:t[1]||(t[1]=L(i=>o.handleSaveName(a.nameData.content,a.nameData.subject_id),["prevent"]))},[f(g,{modelValue:a.nameData.content,"onUpdate:modelValue":t[0]||(t[0]=i=>a.nameData.content=i),autofocus:"",autoResize:"",class:"mb-base-2"},null,8,["modelValue"]),f(m,{class:"w-full"},{default:y(()=>[w(l(e.$t("Save")),1)]),_:1})],32)}const Z=v(W,[["render",X]]),ee={components:{BaseSwitch:Q},data(){return{settings:[],groupInfo:this.dialogRef.data.groupInfo}},inject:{dialogRef:{default:null}},mounted(){this.handleGetNotificationSettings()},methods:{...B(S,["handleGetGroupDetail"]),titleText(e){switch(e){case"request_join_notify":return this.$t("Join Requests");case"pending_post_notify":return this.$t("Post Approval Requests");case"pin_post":return this.$t("A post is pinned");default:return null}},descriptionText(e){switch(e){case"request_join_notify":return this.$t("As an admin or owner of a group, you will receive a notification when someone sends your group a message.");case"pending_post_notify":return this.$t("As an admin or owner of the group, you will receive a notification when there is a new notification related to your group.");case"pin_post":return this.$t("As member of the group, you will receive a notification when admin or moderator of the group pins a post.");default:return null}},handleGetNotificationSettings(){this.settings=window._.map(this.groupInfo.notify_settings,function(e,t){return{name:t,value:e}})},async handleChangeNotificationSettings(){try{let e={id:this.groupInfo.id};window._.forEach(this.settings,function(t){e[t.name]=t.value}),await T(e),this.handleGetGroupDetail(this.groupInfo.id)}catch(e){this.showError(e.error)}}}},te={class:"flex flex-col gap-base-2"},oe={class:"flex-1"},se={class:"font-bold"},ae={class:"text-sub-color text-base-xs dark:text-slate-400"};function ne(e,t,u,_,a,o){const g=p("BaseSwitch");return s(),r("div",te,[(s(!0),r(k,null,C(a.settings,(m,i)=>(s(),r("div",{key:m.name,class:"flex gap-4"},[n("label",oe,[n("div",se,l(o.titleText(m.name)),1),n("div",ae,l(o.descriptionText(m.name)),1)]),f(g,{modelValue:a.settings[i].value,"onUpdate:modelValue":d=>a.settings[i].value=d,onChange:o.handleChangeNotificationSettings,size:"md"},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))])}const re=v(ee,[["render",ne]]),ie={components:{BaseButton:I,RuleItem:Y},inject:["dialogRef"],data(){return{rulesList:this.dialogRef.data.rulesList}},methods:{handleAcceptRules(){this.dialogRef.close({accepted:!0})}}},le={class:"flex flex-col gap-base-2"};function ue(e,t,u,_,a,o){const g=p("RuleItem"),m=p("BaseButton");return s(),r("div",le,[(s(!0),r(k,null,C(a.rulesList,i=>(s(),b(g,{key:i.id,item:i},null,8,["item"]))),128)),f(m,{class:"w-full",onClick:o.handleAcceptRules},{default:y(()=>[w(l(e.$t("Accept & Join")),1)]),_:1},8,["onClick"])])}const de=v(ie,[["render",ue]]),ce={data(){return{group:this.dialogRef.data.group}},inject:{dialogRef:{default:null}},computed:{...D(V,["authenticated"]),importantActionClass(){return"options-menu-modal-text options-menu-modal-border text-center p-4 border-t border-light-divider first:border-none dark:border-white/10 text-base-red font-bold"},normalActionClass(){return"options-menu-modal-sub-text options-menu-modal-border text-center p-4 border-t border-light-divider first:border-none dark:border-white/10"}},methods:{handleReportGroup(e){this.dialogRef.close(),setTimeout(()=>this.$dialog.open(q,{data:{type:"groups",id:e},props:{header:this.$t("Report"),class:"group-report-modal",modal:!0,draggable:!1}}),300)},handleShareGroup(e,t){this.dialogRef.close(),setTimeout(()=>{this.authenticated?this.$dialog.open(O,{data:{subjectType:e,subject:t},props:{showHeader:!1,class:"dropdown-menu-modal",modal:!0,dismissableMask:!0,draggable:!1},onClose:()=>{E()}}):this.showRequireLogin()},300)},handleDoCancel(){this.dialogRef.close()}}},he={class:"options-menu-modal flex flex-col text-main-color dark:text-white outline-none",tabindex:"0",autofocus:""};function pe(e,t,u,_,a,o){return s(),r("div",he,[a.group.canReport?(s(),r("button",{key:0,class:R(o.importantActionClass),onClick:t[0]||(t[0]=g=>o.handleReportGroup(a.group.id))},l(e.$t("Report")),3)):h("",!0),n("button",{class:R(o.normalActionClass),onClick:t[1]||(t[1]=g=>o.handleShareGroup("groups",a.group))},l(e.$t("Share")),3),n("button",{class:R(o.normalActionClass),onClick:t[2]||(t[2]=g=>o.handleDoCancel())},l(e.$t("Cancel")),3)])}const ge=v(ce,[["render",pe]]),me={components:{BaseInputText:K,BaseButton:I,OverlayPanel:J},inject:{dialogRef:{default:null}},data(){return{searchKeyword:"",searchResultsList:{},hashtagChar:P.HASHTAG,item:this.dialogRef.data.item,type:this.dialogRef.data.type}},methods:{...B(S,["setSearchKeyword","setSearchType"]),...B(j,["setCurrentRouter"]),handleShowResultsBox(e){this.$refs.searchDropdownResult.show(e)},handleCloseResultsBox(e){this.$refs.searchDropdownResult.hide(e)},openSearchBox(){var e;(e=this.$refs.showButton)==null||e.click()},closeSearchBox(){var e;(e=this.$refs.hideButton)==null||e.click()},debouncedSearch:window._.debounce(function(){this.getSearchSuggestsList(this.searchKeyword)},500),onEnterSearch(){this.debouncedSearch()},async getSearchSuggestsList(e){if(e)try{this.searchResultsList.text=e,this.searchResultsList.hashtags=null;const t=await H(e);this.openSearchBox(),t.hashtags.length&&(this.searchResultsList.hashtags=t.hashtags)}catch(t){console.log(t)}},matchingSearch(e){let t=this.searchKeyword;return e=window._.replace(window._.lowerCase(e),window._.lowerCase(t),'<span class="font-bold">'+t+"</span>"),e},handleSelectKeyword(e,t){this.setSearchKeyword(e),this.setSearchType(t),this.dialogRef.close();let u;switch(this.type){case"group":u=this.$router.resolve({name:"group_profile",params:{id:this.item.id,slug:this.item.slug}});break}u&&(M(u.fullPath),this.setCurrentRouter({name:u.name,params:u.params}))}}},fe={for:""},be={class:"relative"},we={key:0},ye=["innerHTML"],ve=["onClick"],_e=["innerHTML"];function Be(e,t,u,_,a,o){const g=p("BaseInputText"),m=p("OverlayPanel"),i=p("BaseButton");return s(),r("div",null,[n("form",{onSubmit:t[5]||(t[5]=L(d=>o.handleSelectKeyword(a.searchResultsList.text,"keyword"),["prevent"])),class:"flex flex-col gap-base-2"},[n("label",fe,l(e.$t("Keyword / Hashtags")),1),n("div",be,[f(g,{modelValue:a.searchKeyword,"onUpdate:modelValue":t[0]||(t[0]=d=>a.searchKeyword=d),onInput:t[1]||(t[1]=d=>o.onEnterSearch()),autofocus:""},null,8,["modelValue"]),n("div",{ref:"showButton",onClick:t[2]||(t[2]=(...d)=>o.handleShowResultsBox&&o.handleShowResultsBox(...d))},null,512),n("div",{ref:"hideButton",onClick:t[3]||(t[3]=(...d)=>o.handleCloseResultsBox&&o.handleCloseResultsBox(...d))},null,512),f(m,{ref:"searchDropdownResult",class:"max-w-[464px] w-full"},{default:y(()=>[a.searchKeyword?(s(),r("div",we,[n("div",{class:"text-sm p-base-2 cursor-pointer",onClick:t[4]||(t[4]=d=>o.handleSelectKeyword(a.searchResultsList.text,"keyword"))},[n("div",{innerHTML:o.matchingSearch(a.searchResultsList.text)},null,8,ye)]),(s(!0),r(k,null,C(a.searchResultsList.hashtags,(d,$)=>(s(),r("div",{key:$,onClick:c=>o.handleSelectKeyword(d.name,"hashtag"),class:"text-sm p-base-2 cursor-pointer"},[n("div",{innerHTML:a.hashtagChar+o.matchingSearch(d.name)},null,8,_e)],8,ve))),128))])):h("",!0)]),_:1},512)]),f(i,null,{default:y(()=>[w(l(e.$t("Search")),1)]),_:1})],32)])}const ke=v(me,[["render",Be]]),Ce={props:["data","params","position"],components:{BaseButton:I,BaseIcon:U,BaseUploadCover:F,Avatar:z},data(){return{loadingJoinButton:!1,loadingLeaveButton:!1,loadingCancelButton:!1}},computed:{...D(S,["groupInfo","groupRulesList"]),countRequest(){return this.groupInfo.member_request_count+this.groupInfo.post_pending_count}},methods:{...B(S,["handleDeleteJoinRequest","joinGroup","leaveGroup","handleGetGroupDetail"]),...B(j,["setCurrentRouter"]),handleEditName(){this.$dialog.open(Z,{data:{nameData:{content:this.groupInfo.name,subject_id:this.groupInfo.id,subject_type:"group"}},props:{header:this.$t("Edit Name"),modal:!0,dismissableMask:!0,draggable:!1},onClose:e=>{e.data&&(this.groupInfo.name=e.data.name)}})},privacyIcon(e){switch(e){case 1:return"lock";default:return"earth"}},handleOpenNotificationSettings(){this.$dialog.open(re,{data:{groupInfo:this.groupInfo},props:{header:this.$t("Notification Settings"),modal:!0,dismissableMask:!0,draggable:!1,class:"p-dialog-lg"}})},async handleJoinGroup(e){const t=async()=>{this.loadingJoinButton=!0;try{await this.joinGroup(e),this.handleGetGroupDetail(this.groupInfo.id)}catch(u){this.showError(u.error)}finally{this.loadingJoinButton=!1}};this.groupRulesList.length?this.$dialog.open(de,{data:{rulesList:this.groupRulesList},props:{header:this.$t("Group rules"),modal:!0,dismissableMask:!0,draggable:!1,class:"p-dialog-lg"},onClose:async u=>{u.data.accepted&&await t()}}):await t()},async handleLeaveGroup(e){this.$confirm.require({message:this.$t("Do you want to leave this group?"),header:this.$t("Please confirm"),acceptLabel:this.$t("Ok"),rejectLabel:this.$t("Cancel"),accept:async()=>{this.loadingLeaveButton=!0;try{await this.leaveGroup(e),this.handleGetGroupDetail(this.groupInfo.id)}catch(t){this.showError(t.error)}finally{this.loadingLeaveButton=!1}}})},async handleCancelPending(e){this.$confirm.require({message:this.$t("Do you want to cancel your group join request?"),header:this.$t("Please confirm"),acceptLabel:this.$t("Ok"),rejectLabel:this.$t("Cancel"),accept:async()=>{this.loadingCancelButton=!0;try{await this.handleDeleteJoinRequest(e)}catch(t){this.showError(t.error)}finally{this.loadingCancelButton=!1}}})},handleOpenOptionsMenu(){this.$dialog.open(ge,{data:{group:this.groupInfo},props:{showHeader:!1,class:"dropdown-menu-modal",modal:!0,dismissableMask:!0,draggable:!1}})},handleOpenSearch(){this.$dialog.open(ke,{data:{item:this.groupInfo,type:"group"},props:{header:this.$t("Search Group"),modal:!0,dismissableMask:!0,draggable:!1}})},handleViewMembers(){if(!this.groupInfo.canView)return;let e=this.$router.resolve({name:"group_profile",params:{id:this.groupInfo.id,slug:this.groupInfo.slug,tab:"members"}});M(e.fullPath),this.setCurrentRouter({name:e.name,params:e.params})}}},Re={key:0,class:"header-profile bg-white rounded-none md:rounded-base-lg dark:bg-slate-800 mb-base-2"},Se={class:"relative overflow-hidden rounded-none md:rounded-t-base-lg pb-[38.5%]"},Ie={class:"absolute inset-0 h-full"},$e={class:"p-4"},xe={class:"flex flex-wrap justify-between items-start gap-x-5 gap-y-base-2 mb-base-2"},Ge={class:"flex-1 max-w-full whitespace-nowrap"},Le={class:"flex items-start gap-base-2 mb-1"},De={class:"header-profile-name text-base-lg font-extrabold truncate"},je={class:"flex items-center gap-base-1"},Me={class:"flex flex-wrap items-center gap-2"},Ne={key:0,class:"flex flex-wrap mb-1"},Ae={key:1,class:"flex items-center"};function Te(e,t,u,_,a,o){const g=p("BaseUploadCover"),m=p("BaseIcon"),i=p("BaseButton"),d=p("router-link"),$=p("Avatar");return e.groupInfo?(s(),r("div",Re,[n("div",Se,[n("div",Ie,[n("div",{class:"bg-cover bg-center bg-no-repeat w-full h-full",style:G({backgroundImage:`url(${e.groupInfo.cover})`})},null,4)]),e.groupInfo.is_admin?(s(),b(g,{key:0,type:"group","subject-id":e.groupInfo.id,class:"absolute top-base-2 end-base-2"},null,8,["subject-id"])):h("",!0)]),n("div",$e,[n("div",xe,[n("div",Ge,[n("div",Le,[n("div",De,l(e.groupInfo.name),1),e.groupInfo.is_admin?(s(),r("button",{key:0,onClick:t[0]||(t[0]=(...c)=>o.handleEditName&&o.handleEditName(...c))},[f(m,{name:"pencil"})])):h("",!0)]),n("div",je,[f(m,{name:o.privacyIcon(e.groupInfo.type)},null,8,["name"]),n("span",null,l(e.groupInfo.type_text),1)])]),n("div",Me,[e.groupInfo.canJoin?(s(),b(i,{key:0,type:"outlined",loading:a.loadingJoinButton,onClick:t[1]||(t[1]=c=>o.handleJoinGroup(e.groupInfo))},{default:y(()=>[w(l(e.$t("Join")),1)]),_:1},8,["loading"])):h("",!0),e.groupInfo.canLeave?(s(),b(i,{key:1,loading:a.loadingLeaveButton,type:"danger-outlined",onClick:t[2]||(t[2]=c=>o.handleLeaveGroup(e.groupInfo))},{default:y(()=>[w(l(e.$t("Leave")),1)]),_:1},8,["loading"])):h("",!0),e.groupInfo.request_id?(s(),b(i,{key:2,type:"danger-outlined",loading:a.loadingCancelButton,onClick:t[3]||(t[3]=c=>o.handleCancelPending(e.groupInfo))},{default:y(()=>[w(l(e.$t("Cancel Request")),1)]),_:1},8,["loading"])):h("",!0),e.groupInfo.is_admin?(s(),b(i,{key:3,type:"outlined",to:{name:"groups_manage",params:{id:e.groupInfo.id}},badge:e.shortenNumber(o.countRequest)},{default:y(()=>[w(l(e.$t("Manage")),1)]),_:1},8,["to","badge"])):h("",!0),e.groupInfo.is_member?(s(),b(i,{key:4,type:"outlined",icon:"bell",onClick:o.handleOpenNotificationSettings},null,8,["onClick"])):h("",!0),e.groupInfo.canView?(s(),b(i,{key:5,type:"outlined",icon:"search",onClick:o.handleOpenSearch},null,8,["onClick"])):h("",!0),f(i,{type:"outlined",icon:"more_horiz_outlined",onClick:o.handleOpenOptionsMenu},null,8,["onClick"])])]),e.groupInfo.categories&&e.groupInfo.categories.length?(s(),r("div",Ne,[(s(!0),r(k,null,C(e.groupInfo.categories,(c,x)=>(s(),r("span",{key:c.id},[f(d,{to:{name:"groups",params:{tab:"all"},query:{category_id:c.id}}},{default:y(()=>[w(l(c.name),1)]),_:2},1032,["to"]),w(" "+l(x===e.groupInfo.categories.length-1?"":"· "),1)]))),128))])):h("",!0),e.groupInfo.members.length?(s(),r("div",Ae,[(s(!0),r(k,null,C(e.groupInfo.members,(c,x)=>(s(),b($,{key:c.id,user:c,border:!1,size:32,class:"-ms-3 first:ms-0 relative border-3 border-white rounded-full dark:border-slate-800",style:G({zIndex:e.groupInfo.members.length-x})},null,8,["user","style"]))),128)),n("div",{onClick:t[4]||(t[4]=c=>o.handleViewMembers()),class:R(["text-base-xs text-sub-color ms-2 dark:text-slate-400",e.groupInfo.canView?"cursor-pointer":""])},l(e.$filters.numberShortener(e.groupInfo.member_count,e.$t("[number] member"),e.$t("[number] members"))),3)])):h("",!0)])])):h("",!0)}const Ke=v(Ce,[["render",Te]]);export{Ke as default};
