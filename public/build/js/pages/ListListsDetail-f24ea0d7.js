import{_ as g,B as M,ao as w,an as B,bZ as k,b_ as y,r as n,o as f,c as _,b as r,t as c,d as a,w as h,e as L,j as S,s as v,b$ as C,c0 as I,F as U}from"../../assets/app-8df99815.js";import{G as A}from"./GroupMembersList-c38b600c.js";const $={inject:["dialogRef"],components:{BaseButton:M,AutoSuggestUserItem:w,BaseSuggest:B},data(){var s;return{userMentionList:null,selectedUser:[],id:(s=this.dialogRef.data)==null?void 0:s.id}},methods:{async suggestUsersMention(s){try{this.userMentionList=await k(s.query,1)}catch{this.userMentionList=[]}},async handleClickAddMemberToList(){if(this.selectedUser.length===0){this.showError(this.$t("Please select user to add."));return}try{const s=await y({id:this.id,user_ids:this.selectedUser.map(e=>e.id)});this.showSuccess(this.$t("Add Member Successfully.")),this.dialogRef.close({response:s})}catch(s){this.showError(s.error)}}}},x={class:"mb-base-2"},G={class:"mb-1"};function V(s,e,i,l,t,o){const u=n("AutoSuggestUserItem"),b=n("BaseSuggest"),p=n("BaseButton");return f(),_("div",null,[r("div",x,[r("div",G,[r("label",null,c(s.$t("Enter Name")),1)]),a(b,{modelValue:t.selectedUser,"onUpdate:modelValue":e[0]||(e[0]=m=>t.selectedUser=m),suggestions:t.userMentionList,multiple:"",optionLabel:"name",onComplete:o.suggestUsersMention,emptySearchMessage:s.$t("No users found")},{option:h(({option:m})=>[a(u,{user:m},null,8,["user"])]),_:1},8,["modelValue","suggestions","onComplete","emptySearchMessage"])]),a(p,{onClick:e[1]||(e[1]=m=>o.handleClickAddMemberToList()),class:"w-full"},{default:h(()=>[L(c(s.$t("Add")),1)]),_:1})])}const T=g($,[["render",V]]),E={props:["item"],components:{BaseIcon:S,BaseButton:M,GroupMembersList:A,BaseInputText:v},data(){return{page:1,keyword:"",loadingMembers:!0,membersList:[],hasMoreMembers:!1,itemInfo:this.item}},mounted(){this.handleGetMembersList(this.item.id,this.page,this.keyword)},methods:{async handleGetMembersList(s,e,i){try{const l=await C(s,e,i);e===1&&(this.membersList=[]),this.membersList=window._.concat(this.membersList,l.items),l.has_next_page?(this.hasMoreMembers=!0,this.page++):this.hasMoreMembers=!1}catch(l){this.showError(l.error)}finally{this.loadingMembers=!1}},debouncedSearchMembersList:window._.debounce(function(){this.handleGetMembersList(this.item.id,this.page,this.keyword)},500),handleSearchMembers(){this.page=1,this.debouncedSearchMembersList()},handleAddMember(){this.$dialog.open(T,{data:{id:this.item.id},props:{header:this.$t("Add Members"),modal:!0,dismissableMask:!0,draggable:!1},onClose:s=>{var i;const e=(i=s.data)==null?void 0:i.response;e&&(this.page=1,this.handleGetMembersList(this.item.id,this.page,this.keyword),this.itemInfo=e)}})},handleRemoveMember(s){this.$confirm.require({message:this.$t("Do you want to remove this member?"),header:this.$t("Please confirm"),acceptLabel:this.$t("Ok"),rejectLabel:this.$t("Cancel"),accept:async()=>{try{await I(s),this.membersList=this.membersList.filter(e=>e.id!==s),this.itemInfo.member_count--}catch(e){this.showError(e.error)}}})},handleBack(){this.$emit("back",this.itemInfo)}},emits:["back"]},R={class:"flex items-center justify-between gap-3 mb-5"},N={class:"flex items-center gap-base-2"},j={class:"text-2xl font-bold"},D=["onClick"];function q(s,e,i,l,t,o){const u=n("BaseIcon"),b=n("BaseButton"),p=n("BaseInputText"),m=n("GroupMembersList");return f(),_(U,null,[r("div",R,[r("div",N,[r("button",{onClick:e[0]||(e[0]=(...d)=>o.handleBack&&o.handleBack(...d))},[a(u,{name:"caret_left",class:"align-middle"})]),r("h2",j,c(i.item.name),1)]),a(b,{onClick:o.handleAddMember},{default:h(()=>[L(c(s.$t("Add Member")),1)]),_:1},8,["onClick"])]),r("div",null,[a(p,{modelValue:t.keyword,"onUpdate:modelValue":e[1]||(e[1]=d=>t.keyword=d),placeholder:s.$t("Search"),right_icon:"search",onInput:o.handleSearchMembers,class:"max-w-xs mb-5"},null,8,["modelValue","placeholder","onInput"]),a(m,{loading:t.loadingMembers,"members-list":t.membersList,"has-load-more":t.hasMoreMembers,onLoadMore:e[2]||(e[2]=d=>o.handleGetMembersList(i.item.id,t.page,t.keyword))},{actions:h(({member:d})=>[r("button",{class:"text-base-red",onClick:F=>o.handleRemoveMember(d.id)},c(s.$t("Remove")),9,D)]),_:1},8,["loading","members-list","has-load-more"])])],64)}const Z=g(E,[["render",q]]);export{Z as default};
