import{_ as g,B as m,m as n,y as f,du as d,u as _,p as u,r as h,o as A,c as y,d as p,b as w,w as v,e as B,t as I,a8 as l}from"../../assets/app-8df99815.js";import{f as C}from"./style-a13dfc58.js";const R={components:{Cropper:C,BaseButton:m},inject:{dialogRef:{default:null}},data(){return{image:this.dialogRef.data.imageData,loading:!1}},computed:{...n(f,["user"]),...n(d,["userInfo"]),...n(_,["config"])},methods:{...u(f,["uploadAvatarPicture","updateUserMeInfo"]),...u(d,["setUserInfo"]),async cropAvatar(){const s=()=>{let{canvas:t}=this.$refs.cropper.getResult();if(t){const a=new FormData;var e;if(t.width>l.AVATAR_WIDTH){e=document.createElement("canvas");var c=e.getContext("2d");e.width=l.AVATAR_WIDTH,e.height=l.AVATAR_HEIGHT,c.drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height)}else e=t;e.toBlob(async r=>{let i=new File([r],"Avatar.png",{type:"image/png"});if(a.append("file",i),!this.loading){this.loading=!0;try{await this.uploadAvatarPicture(a).then(o=>{this.dialogRef.close(o)})}catch(o){this.showError(o.error)}finally{this.loading=!1}}})}};this.user.is_verify&&this.config.userVerifyLostWhen=="2"?this.$confirm.require({message:this.$t("You will lose your profile verification badge if you change your photo. Do you want to continue?"),header:this.$t("Please confirm"),acceptLabel:this.$t("Ok"),rejectLabel:this.$t("Cancel"),accept:()=>{s(),this.updateUserMeInfo({...this.user,is_verify:!1}),this.setUserInfo({...this.userInfo,is_verify:!1})}}):s()}}},$={class:"text-end mt-base-2"};function D(s,t,e,c,a,r){const i=h("cropper"),o=h("BaseButton");return A(),y("div",null,[p(i,{ref:"cropper","stencil-props":{aspectRatio:1/1},"min-width":200,src:a.image},null,8,["src"]),w("div",$,[p(o,{loading:a.loading,onClick:r.cropAvatar},{default:v(()=>[B(I(s.$t("Crop Avatar Image")),1)]),_:1},8,["loading","onClick"])])])}const x=g(R,[["render",D]]);export{x as default};
