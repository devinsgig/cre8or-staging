import{L as S,j as p,c8 as I,c9 as _,m as d,p as k,ca as x,l as c,cb as P,ad as b,_ as L,u as D,bV as f,y as N,r as y,o,c as n,b as w,F as M,f as B,h,S as V,d as u,g as C}from"../../assets/app-8df99815.js";const E={components:{Loading:S,BaseIcon:p,StoryItemDetail:I},props:{storyId:{default:""},storiesList:{default:[]},isPage:{default:!1}},data(){return{id:this.storyId,story:null,storyItem:null,showPrev:!1,showNext:!1,interval:null,time:0,run:!1,shareModalIsOpen:!1}},watch:{storyItem(t){if(t){if(this.authenticated){_({id:t.id});var e=window._.findIndex(this.story.items,function(a){return a.id==t.id}),i=e==this.story.items.length-1;this.setSeenStoryItem({storyItem:i?this.story.items[0]:this.story.items[e+1],seen:i})}this.time=0,this.doPlayStory()}},time(t){parseInt(t)==this.config.story.timeout&&(clearInterval(this.interval),this.interval=null,this.run=!1,this.showNext?this.nextStories():this.isPage||(this.$emit("closeModal"),this.storyItem=null))},deleteStoryItem(){this.story.items&&window._.find(this.story.items,{id:this.deleteStoryItem.id})&&(this.story.items=this.story.items.filter(t=>t.id!==this.deleteStoryItem.id),this.showPrev&&this.prevStories(),this.showNext&&this.nextStories()),this.storyItem&&this.storyItem.id==this.deleteStoryItem.id&&(this.$emit("closeModal"),this.storyItem=null)},shareModalIsOpen(t){t?window.removeEventListener("keydown",this.onKeyDown):window.addEventListener("keydown",this.onKeyDown)}},mounted(){this.id&&(this.loadStoryDetail(this.id),window.addEventListener("keydown",this.onKeyDown))},unmounted(){window.removeEventListener("keydown",this.onKeyDown)},computed:{...d(D,["config"]),...d(f,["deleteStoryItem"]),...d(N,["user","authenticated"])},methods:{...k(f,["setSeenStoryItem"]),async loadStoryDetail(t){try{this.story=await x(t);var e=this;this.storyItem=window._.find(this.story.items,function(i){return i.id==e.story.item_view_id}),this.checkShowButton()}catch(i){this.$emit("setError"),this.isPage||this.showError(i.error)}},prevStories(){var t=this,e=window._.findLast(this.story.items,function(s){return s.id<t.storyItem.id});if(e)this.storyItem=e,this.checkShowButton();else{var i=this.getIndexStory(),a=this.storiesList[i-1];this.id=a.id,this.loadStoryDetail(this.id);let s=this.$router.resolve({name:"story_view",params:{storyId:this.id}});c(s.fullPath)}},nextStories(){var t=this,e=window._.find(this.story.items,function(s){return s.id>t.storyItem.id});if(e)this.storyItem=e,this.checkShowButton();else{var i=this.getIndexStory(),a=this.storiesList[i+1];this.id=a.id,this.loadStoryDetail(this.id);let s=this.$router.resolve({name:"story_view",params:{storyId:this.id}});c(s.fullPath)}},checkShowButton(){var t=this,e=window._.findIndex(this.story.items,function(i){return i.id==t.storyItem.id});e==0&&this.story.items.length==1?(this.checkPrev(),this.checkNext()):e==0?(this.checkPrev(),this.showNext=!0):e==this.story.items.length-1?(this.checkNext(),this.showPrev=!0):(this.showPrev=!0,this.showNext=!0)},checkPrev(){var t=this.getIndexStory();t<1?this.showPrev=!1:this.showPrev=!0},checkNext(){var t=this.getIndexStory();this.storiesList.length>1&&t<this.storiesList.length-1?this.showNext=!0:this.showNext=!1},getIndexStory(){var t=this;return window._.findIndex(this.storiesList,function(e){return e.id==t.id})},doPlayStory(){parseInt(this.time)>=this.config.story.timeout&&(this.time=0,this.storyItem=this.story.items[0],this.checkShowButton()),this.run=!0,this.interval!=null&&clearInterval(this.interval),this.interval=setInterval(()=>{this.time+=.01},10)},stopPlayStory(){clearInterval(this.interval),this.interval=null,this.run=!1},openViewersModal(t){this.$dialog.open(P,{data:{itemId:t},props:{header:this.$t("Viewers"),class:"likers-modal",modal:!0,dismissableMask:!0,draggable:!1},onClose:()=>{b(),this.doPlayStory()}}),this.stopPlayStory()},onKeyDown(t){switch(t.key){case"ArrowLeft":this.user.rtl?this.showNext&&this.nextStories():this.showPrev&&this.prevStories(),t.stopPropagation(),t.preventDefault();break;case"ArrowRight":this.user.rtl?this.showPrev&&this.prevStories():this.showNext&&this.nextStories(),t.stopPropagation(),t.preventDefault();break}},handleShareStoryModal(t){this.shareModalIsOpen=t}}},A={key:0,class:"h-full w-full select-none"},K={class:"h-full w-full relative"},z={class:"absolute top-4 left-2 right-2 lg:left-4 lg:right-4 flex gap-1 z-10"},j={key:0,class:"rounded-full h-1 w-full bg-white story-progress-bar"};function O(t,e,i,a,s,l){const v=y("StoryItemDetail"),m=y("BaseIcon"),g=y("Loading");return s.story?(o(),n("div",A,[w("div",K,[w("div",z,[(o(!0),n(M,null,B(s.story.items,r=>(o(),n("div",{key:r.id,class:"flex-1 bg-gray-400 rounded-full story-remaining-bar"},[s.storyItem.id>r.id?(o(),n("div",j)):h("",!0),s.storyItem.id==r.id?(o(),n("div",{key:1,class:"rounded-full h-1 w-full bg-progress story-progress-bar",style:V({width:s.time*100/t.config.story.timeout+"%"})},null,4)):h("",!0)]))),128))]),u(v,{canMessage:s.story.canMessage,story:s.storyItem,owner:s.story.user,runningStory:s.run,isPage:i.isPage,onPlay_story:l.doPlayStory,onStop_story:l.stopPlayStory,onClose_story_modal:e[0]||(e[0]=r=>t.$emit("closeModal")),onShare_story_modal_open:l.handleShareStoryModal},null,8,["canMessage","story","owner","runningStory","isPage","onPlay_story","onStop_story","onShare_story_modal_open"])]),s.showPrev?(o(),n("button",{key:0,onClick:e[1]||(e[1]=(...r)=>l.prevStories&&l.prevStories(...r)),class:"absolute top-1/2 -translate-y-1/2 ltr:left-2 ltr:lg:-left-20 rtl:right-2 rtl:lg:-right-20 z-10 flex items-center justify-center w-10 h-10 bg-white rounded-full shadow-md text-main-color dark:bg-dark-web-wash dark:text-white"},[u(m,{name:t.user.rtl?"caret_right":"caret_left"},null,8,["name"])])):h("",!0),s.showNext?(o(),n("button",{key:1,onClick:e[2]||(e[2]=(...r)=>l.nextStories&&l.nextStories(...r)),class:"absolute top-1/2 -translate-y-1/2 ltr:right-2 ltr:lg:-right-20 rtl:left-2 rtl:lg:-left-20 z-10 flex items-center justify-center w-10 h-10 bg-white rounded-full shadow-md text-main-color dark:bg-dark-web-wash dark:text-white"},[u(m,{name:t.user.rtl?"caret_left":"caret_right"},null,8,["name"])])):h("",!0)])):(o(),C(g,{key:1,class:"mx-auto"}))}const F=L(E,[["render",O]]);export{F as S};
