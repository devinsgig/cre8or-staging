import{_ as x,L as W,s as I,dg as D,dh as L,r as l,o as s,c as a,d as i,g as p,F as _,f as V,t as m,di as M,j as N,B as j,cV as O,d2 as T,dj as z,cd as A,bF as $,c$ as F,m as H,dk as q,a8 as C,d6 as Y,dl as G,b as d,w as g,e as f,h as y,u as J,S as K}from"../../assets/app-8df99815.js";import{S as Q}from"./SongItem-3bef75af.js";var k=null;const X={components:{SongItem:Q,Loading:W,BaseInputText:I},data(){return{defaultSongs:[],isSearching:!1,isLoadingSearch:!0,searchSongs:[],isShownSearchBox:!1,searchContent:""}},mounted(){this.getVibbConfig()},methods:{async getVibbConfig(){try{const e=await D();this.defaultSongs=window._.map(e.songs,function(t){return window._.extend({},t,{is_selected:!1})})}catch(e){this.showError(e.error)}},async getSongs(e){try{const t=await L(e);this.searchSongs=window._.map(t,function(u){return window._.extend({},u,{is_selected:!1})}),this.isLoadingSearch=!1}catch(t){this.showError(t.error),this.isLoadingSearch=!1}},onEnterSearch(){if(this.searchContent.trim()!=""){clearTimeout(k);var e=this;k=setTimeout(function(){e.searchContent.trim()!=""&&e.getSongs(e.searchContent)},600),this.isSearching=!0}else this.isSearching=!1},selectSong(e){this.searchSongs.map(t=>(t.is_selected=!1,t.id==e.id&&(t.is_selected=!0),t)),this.defaultSongs.map(t=>(t.is_selected=!1,t.id==e.id&&(t.is_selected=!0),t)),this.$emit("select_song",e)},removeSong(e){this.searchSongs.map(t=>(t.id==e.id&&(t.is_selected=!1),t)),this.defaultSongs.map(t=>(t.id==e.id&&(t.is_selected=!1),t)),this.$emit("remove_song")},reset(){this.searchSongs.forEach(e=>{e.is_selected=!1}),this.defaultSongs.forEach(e=>{e.is_selected=!1})}},emits:["select_song","remove_song"]},Z={class:"bg-white text-main-color rounded-base-lg p-base-2 dark:text-white dark:bg-slate-800 dark:border-white/10"},ee={key:0,class:"mt-base-2"},te={key:0,class:"max-h-32 overflow-auto pe-1 scrollbar-thin mt-base-2"},oe={key:1,class:"text-center"},ne={key:0,class:"max-h-32 overflow-auto pe-1 scrollbar-thin mt-base-2"},se={key:1,class:"text-center mt-base-2"};function ie(e,t,u,S,o,n){const v=l("BaseInputText"),h=l("Loading"),b=l("SongItem");return s(),a("div",Z,[i(v,{placeholder:e.$t("Search Song"),left_icon:"search",modelValue:o.searchContent,"onUpdate:modelValue":t[0]||(t[0]=r=>o.searchContent=r),onInput:t[1]||(t[1]=r=>n.onEnterSearch())},null,8,["placeholder","modelValue"]),o.isSearching?(s(),a("div",ee,[o.isLoadingSearch?(s(),p(h,{key:0})):(s(),a(_,{key:1},[o.searchSongs.length>0?(s(),a("div",te,[(s(!0),a(_,null,V(o.searchSongs,r=>(s(),p(b,{key:r.id,song:r,onSelect_song_item:w=>n.selectSong(r),onRemove_song_item:n.removeSong},null,8,["song","onSelect_song_item","onRemove_song_item"]))),128))])):(s(),a("div",oe,m(e.$t("No songs found")),1))],64))])):(s(),a(_,{key:1},[o.defaultSongs.length>0?(s(),a("div",ne,[(s(!0),a(_,null,V(o.defaultSongs,r=>(s(),p(b,{key:r.id,song:r,onSelect_song_item:w=>n.selectSong(r),onRemove_song_item:n.removeSong},null,8,["song","onSelect_song_item","onRemove_song_item"]))),128))])):(s(),a("div",se,m(e.$t("No Songs")),1))],64))])}const ae=x(X,[["render",ie]]),re={components:{UploadWrap:M,BaseIcon:N,BaseButton:j,Songs:ae,Mentionable:O,UploadVideo:T,BaseSelectContentWarning:z,BaseSelectPrivacy:A,ContentWarningWrapper:$,ProgressBar:F},data(){return{uploadedVideo:null,description:"",commentPrivacy:"everyone",isContentWarning:!1,contentWarningSelecteds:[],videoUploadProgress:0,selectedSong:null,error:{description:""},loadingCreate:!1}},computed:{...H(J,["config"]),privaciesList(){var e;return[{icon:"globe",name:this.$t("Everyone"),label:this.$t("Everyone can comment"),value:"everyone"},{icon:"user_check",name:this.$t("Accounts you follow"),label:this.$t("Accounts you follow can comment"),value:"following"},{icon:"seal_check",name:this.$t("Verified accounts"),label:this.$t("Only Verified accounts can comment"),value:"verified",isShow:(e=this.config)==null?void 0:e.userVerifyEnable},{icon:"at",name:this.$t("Only accounts you mention"),label:this.$t("Only accounts you mention can comment"),value:"mentioned"}]}},methods:{dropData(e){this.startUploadVideo(e.dataTransfer.files)},uploadVideo(e){this.startUploadVideo(e.target.files)},async startUploadVideo(e){for(var t=0;t<e.length;t++)if(this.checkUploadedData(e[t],"video")){this.uploadedVideo&&this.removeUploadedVideo(this.uploadedVideo.id);let u=new FormData;u.append("file",e[t]);const S=o=>{const n=Math.round(o.loaded*100/o.total);this.videoUploadProgress=n};try{const o=await q(u,S);this.uploadedVideo=o}catch(o){typeof o=="object"?o.error.code==C.RESPONSE_CODE_MEMBERSHIP_PERMISSION?this.showPermissionPopup("vibb",o.error.message):this.showError(o.error):this.showError(this.$t("Upload Failed.")),this.$refs.vibbUploadRef.reset()}finally{this.videoUploadProgress=0}}this.$refs.vibbUploadRef.reset()},handleRemoveVideo(e){try{Y({id:e}),this.uploadedVideo=null,this.videoUploadProgress=0}catch(t){this.showError(t.error)}},async handleCreateVibb(){var e;this.loadingCreate=!0;try{if(this.isContentWarning&&this.contentWarningSelecteds.length===0)return this.showError(this.$t("User must select at least 1 category."));const t=await G({content:this.description,item_id:this.uploadedVideo.id,comment_privacy:this.commentPrivacy,content_warning_categories:this.contentWarningSelecteds.map(u=>u.id),song_id:(e=this.selectedSong)==null?void 0:e.id});this.showSuccess(this.$t("Your vibb has been created.")),this.$router.push({name:"vibb",query:{id:t.id}})}catch(t){t.error.code==C.RESPONSE_CODE_MEMBERSHIP_PERMISSION?this.showPermissionPopup("vibb",t.error.message):this.showError(t.error)}finally{this.loadingCreate=!1}},handleSelectSong(e){this.selectedSong=e},handleRemoveSong(){this.selectedSong=null},handleRemoveSelectedSong(){this.selectedSong=null,this.$refs.songsRef.reset()},handlePutContentWarning(e){this.isContentWarning=e}}},le={class:"main-content-section bg-white border border-white text-main-color rounded-none md:rounded-base-lg p-5 mb-base-2 dark:bg-slate-800 dark:border-slate-800 dark:text-white"},de={class:"flex flex-wrap items-center justify-between gap-2 mb-base-2"},ce={class:"text-main-color text-base-lg font-extrabold dark:text-white"},me={class:"pb-[40%] relative"},ue={key:0,class:"bg-black text-white px-2 py-1 text-xs rounded-lg inline-flex items-center gap-1 absolute bottom-base-2 start-base-2 z-10"},he=["src"],ge={key:1,class:"pb-[65%] md:pb-[40%] relative mb-2"},pe={key:0,class:"bg-black text-white px-2 py-1 text-xs rounded-lg inline-flex items-center gap-1 absolute bottom-base-2 start-base-2 z-10"},be={class:"flex flex-col items-center justify-center text-center gap-base-2 bg-light-web-wash px-10 py-16 rounded-base-lg h-full dark:bg-dark-web-wash"},_e={class:"mb-2"},fe={class:"mb-2"};function Se(e,t,u,S,o,n){const v=l("ProgressBar"),h=l("BaseIcon"),b=l("ContentWarningWrapper"),r=l("BaseButton"),w=l("UploadVideo"),P=l("UploadWrap"),B=l("Songs"),U=l("Mentionable"),E=l("BaseSelectContentWarning"),R=l("BaseSelectPrivacy");return s(),a("div",le,[d("div",de,[d("h3",ce,m(e.$t("Create New Vibb")),1)]),i(v,{value:o.videoUploadProgress,class:"mb-base-2"},null,8,["value"]),o.uploadedVideo?(s(),p(b,{key:0,"content-warning-list":o.contentWarningSelecteds,"button-offset-x":44,class:"mb-2"},{default:g(()=>[d("div",me,[o.selectedSong?(s(),a("span",ue,[i(h,{name:"music_note",size:"16"}),f(" "+m(o.selectedSong.name)+" ",1),d("button",{onClick:t[0]||(t[0]=(...c)=>n.handleRemoveSelectedSong&&n.handleRemoveSelectedSong(...c)),class:"absolute -top-2 -end-2 bg-red-600 text-white rounded-full"},[i(h,{name:"close",size:"16"})])])):y("",!0),d("div",{class:"flex items-center justify-center absolute inset-0 rounded-base-lg overflow-hidden",style:K({backgroundColor:`${o.uploadedVideo.subject.thumb.params.dominant_color?o.uploadedVideo.subject.thumb.params.dominant_color:"#000"}`})},[d("img",{src:o.uploadedVideo.subject.thumb.url,class:"max-h-full max-w-full mx-auto"},null,8,he),d("button",{onClick:t[1]||(t[1]=c=>n.handleRemoveVideo(o.uploadedVideo.id)),class:"bg-black/30 text-white flex justify-center items-center w-8 h-8 rounded-md absolute top-3 end-3"},[i(h,{name:"close"})])],4)])]),_:1},8,["content-warning-list"])):(s(),a("div",ge,[o.selectedSong?(s(),a("span",pe,[i(h,{name:"music_note",size:"16"}),f(" "+m(o.selectedSong.name)+" ",1),d("button",{onClick:t[2]||(t[2]=(...c)=>n.handleRemoveSelectedSong&&n.handleRemoveSelectedSong(...c)),class:"absolute -top-2 -end-2 bg-red-600 text-white rounded-full"},[i(h,{name:"close",size:"16"})])])):y("",!0),i(P,{onDrop_data:n.dropData,class:"absolute inset-0"},{default:g(()=>[i(w,{ref:"vibbUploadRef",onUpload:n.uploadVideo,class:"h-full"},{default:g(()=>[d("div",be,[i(h,{name:"video_camera"}),d("div",null,m(e.$t("Drag or click here to upload")),1),i(r,{class:"pointer-events-none"},{default:g(()=>[f(m(e.$t("Upload video")),1)]),_:1})])]),_:1},8,["onUpload"])]),_:1},8,["onDrop_data"])])),d("div",_e,m(e.$t("Add Music")),1),i(B,{ref:"songsRef",class:"border border-divider mb-2",onSelect_song:n.handleSelectSong,onRemove_song:n.handleRemoveSong},null,8,["onSelect_song","onRemove_song"]),d("div",fe,m(e.$t("Description")),1),i(U,{modelValue:o.description,"onUpdate:modelValue":t[3]||(t[3]=c=>o.description=c),placeholder:e.$t("Enter vibb description"),rows:"3",error:o.error.description,class:"p-inputtext mb-2"},null,8,["modelValue","placeholder","error"]),o.uploadedVideo?(s(),p(E,{key:2,modelValue:o.contentWarningSelecteds,"onUpdate:modelValue":t[4]||(t[4]=c=>o.contentWarningSelecteds=c),onPut_content_warning:n.handlePutContentWarning,class:"mb-base-2"},null,8,["modelValue","onPut_content_warning"])):y("",!0),i(R,{modelValue:o.commentPrivacy,"onUpdate:modelValue":t[5]||(t[5]=c=>o.commentPrivacy=c),options:n.privaciesList,title:e.$t("Who can comment?"),description:e.$t("Choose who can comment to this post. Anyone mentioned can always comment."),class:"mb-base-2"},null,8,["modelValue","options","title","description"]),i(r,{class:"w-full",onClick:n.handleCreateVibb,loading:o.loadingCreate,disabled:!o.uploadedVideo},{default:g(()=>[f(m(e.$t("Continue")),1)]),_:1},8,["onClick","loading","disabled"])])}const ye=x(re,[["render",Se]]);export{ye as default};
