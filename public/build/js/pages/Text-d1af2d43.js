import{bU as j,j as S,m as x,bV as k,p as v,_ as C,r as c,o as a,g as h,w as m,b as t,d as l,c as d,F as L,f as A,Q as M,h as g,B as N,v as R,b2 as D,bO as H,bT as O,a8 as U,bf as F,S as y,e as w,t as p,J as B}from"../../assets/app-8df99815.js";import{B as $,S as J}from"./Songs-b79205ae.js";import"./SongItem-3bef75af.js";const Q={components:{SlimScroll:j,BaseIcon:S},computed:{...x(k,["storyBackgrounds","selectedBackground"])},mounted(){this.getStoryBackgrounds()},methods:{...v(k,["getStoryBackgrounds","selectBackground"])}},Y=["onClick"],q=["src"],G={class:"absolute top-1/2 -translate-y-1/2 -left-2 flex items-center justify-center w-8 h-8 bg-white rounded-full shadow-md text-main-color dark:bg-slate-800 dark:text-white dark:shadow-slate-600 z-10"},K={class:"absolute top-1/2 -translate-y-1/2 -right-2 flex items-center justify-center w-8 h-8 bg-white rounded-full shadow-md text-main-color dark:bg-slate-800 dark:text-white dark:shadow-slate-600 z-10"};function W(o,e,z,T,s,n){const i=c("BaseIcon"),f=c("SlimScroll");return o.storyBackgrounds.length>0?(a(),h(f,{key:0,class:"bg-white rounded-full dark:bg-slate-800",gap:"5",padding:"8"},{prev:m(()=>[t("button",G,[l(i,{name:"caret_left"})])]),next:m(()=>[t("button",K,[l(i,{name:"caret_right"})])]),default:m(()=>[(a(!0),d(L,null,A(o.storyBackgrounds,u=>(a(),d("div",{class:"backgrounds-list-item",key:u.id,onClick:b=>o.selectBackground(u)},[t("img",{class:M(["transition-all w-8 h-8 rounded-full cursor-pointer",u.is_selected?"border-2 border-color-link scale-125 dark:border-dark-primary-color":""]),src:u.photo_url},null,10,q)],8,Y))),128))]),_:1})):g("",!0)}const X=C(Q,[["render",W]]),Z={components:{BaseIcon:S,BaseButton:N,BaseColorPicker:$,BaseTextarea:R,Backgrounds:X,Songs:J,ContentHtml:D,CloseButton:H},inject:["dialogRef"],data(){return{type:"text",content:null,color:"#ffffff",photo:null,selected_song:null,showSongsList:!1,showBackgroundsList:!1,showAddTextarea:!0,loading:!1}},mounted(){this.getStoryBackgrounds()},unmounted(){this.selectBackground(null)},computed:{...x(k,["storyBackgrounds","selectedBackground"])},watch:{$route(){this.dialogRef.close()}},methods:{...v(k,["getStoryBackgrounds","selectBackground"]),toggleSongsList(){this.showSongsList=!this.showSongsList},toggleAddTextarea(){this.showAddTextarea=!this.showAddTextarea},selectSong(o){this.selected_song=o,this.toggleSongsList()},removeSong(){this.selected_song=null},toggleBackgroundsList(){this.showBackgroundsList=!this.showBackgroundsList},async postStory(){if(!this.loading){this.loading=!0;try{await O({type:this.type,content:this.content,content_color:this.color,song_id:this.selected_song?this.selected_song.id:0,background_id:this.selectedBackground.id,photo:this.photo}),this.showSuccess(this.$t("Your story has been posted.")),this.closeCreateStoryModal(),this.$router.push({name:"home"})}catch(o){o.error.code==U.RESPONSE_CODE_MEMBERSHIP_PERMISSION?this.showPermissionPopup("story",o.error.message):this.showError(o.error)}finally{this.loading=!1}}},closeCreateStoryModal(){this.dialogRef.close()}}},ee={class:"h-full"},te={class:"flex h-full"},oe={class:"absolute top-3 left-3 right-3 z-10"},se={class:"flex gap-2 justify-between items-center"},ne={class:"flex gap-2"},le={key:0,class:"bg-black text-white px-2 py-1 text-xs rounded-lg inline-flex items-center gap-1 relative mt-4 z-10"},re={key:0,class:"absolute top-14 left-3 right-3 z-10"},ae={class:"relative leading-none"},ce={class:"absolute bottom-3 end-3"},ie={class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-center text-main-color text-xl max-w-[80%] w-full max-h-[60%] overflow-x-hidden overflow-y-auto story-content-box"},de={key:1,class:"text-sub-color dark:text-slate-300"};function ue(o,e,z,T,s,n){const i=c("BaseIcon"),f=c("BaseButton"),u=c("BaseTextarea"),b=c("BaseColorPicker"),V=c("Songs"),E=c("Backgrounds"),I=c("ContentHtml"),P=c("CloseButton"),_=F("click-outside");return a(),d(L,null,[t("div",ee,[t("div",te,[t("div",{class:"flex-1 bg-cover lg:rounded-base-lg bg-center relative",style:y({backgroundImage:"url("+o.selectedBackground.photo_url+")"})},[t("span",oe,[t("div",se,[t("div",ne,[t("button",{class:"flex justify-center items-center bg-white shadow-md h-8 w-8 rounded-full dark:bg-slate-800 rtl:rotate-180",onClick:e[0]||(e[0]=r=>n.closeCreateStoryModal())},[l(i,{name:"arrow_left",size:"20"})]),t("button",{class:"flex justify-center items-center bg-white shadow-md h-8 w-8 rounded-full dark:bg-slate-800",onClick:e[1]||(e[1]=r=>n.toggleSongsList())},[l(i,{name:"music_notes",size:"20"})]),t("button",{class:"flex justify-center items-center bg-white shadow-md h-8 w-8 rounded-full dark:bg-slate-800",onClick:e[2]||(e[2]=r=>n.toggleAddTextarea())},[l(i,{name:"character",size:"20"})])]),l(f,{loading:s.loading,onClick:e[3]||(e[3]=r=>n.postStory())},{default:m(()=>[w(p(o.$t("Post Story")),1)]),_:1},8,["loading"])]),s.selected_song?(a(),d("span",le,[l(i,{name:"music_note",size:"16"}),w(" "+p(s.selected_song.name)+" ",1),t("button",{onClick:e[4]||(e[4]=(...r)=>n.removeSong&&n.removeSong(...r)),class:"absolute -top-2 -end-2 bg-red-600 text-white rounded-full"},[l(i,{name:"close",size:"16"})])])):g("",!0)]),s.showAddTextarea?B((a(),d("div",re,[t("div",ae,[l(u,{maxlength:1024,modelValue:s.content,"onUpdate:modelValue":e[5]||(e[5]=r=>s.content=r),placeholder:o.$t("Enter Text"),autofocus:!0,classInput:"pe-10 max-h-40"},null,8,["modelValue","placeholder"]),t("span",ce,[l(b,{modelValue:s.color,"onUpdate:modelValue":e[6]||(e[6]=r=>s.color=r)},null,8,["modelValue"])])])])),[[_,n.toggleAddTextarea]]):g("",!0),s.showSongsList?B((a(),h(V,{key:1,class:"absolute top-14 left-3 right-3 z-10",onSelect_song:n.selectSong},null,8,["onSelect_song"])),[[_,n.toggleSongsList]]):g("",!0),o.storyBackgrounds.length>0?(a(),d("button",{key:2,class:"absolute bottom-4 start-3 z-10",onClick:e[7]||(e[7]=r=>n.toggleBackgroundsList())},[l(i,{name:"background"})])):g("",!0),s.showBackgroundsList?B((a(),h(E,{key:3,class:"absolute bottom-3 left-3 right-3 z-20"},null,512)),[[_,n.toggleBackgroundsList]]):g("",!0),t("div",ie,[s.content?(a(),h(I,{key:0,style:y({color:s.color}),content:s.content,limit:100},null,8,["style","content"])):(a(),d("span",de,p(o.$t("Enter Text")),1))])],4)])]),l(P,{onClick:e[8]||(e[8]=r=>n.closeCreateStoryModal())})],64)}const ke=C(Z,[["render",ue]]);export{ke as default};
